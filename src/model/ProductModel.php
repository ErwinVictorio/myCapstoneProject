<?phpnamespace model;use config\DbConnection;use Exception;include_once '../config/DbConnection.php';include_once 'logs.php';class ProductModel extends DbConnection{    private $productStatus = 'Active';   // method to display the product    public function DisplayProducts()    {         $STATUS_ACTIVE = 'Active';         $query = "SELECT * FROM product WHERE status = ?";         $stmt = $this->Connect()->prepare($query);         $stmt->bind_param('s',$STATUS_ACTIVE);         $stmt->execute();         $result = $stmt->get_result();        $tr = '';        if ($result->num_rows > 0) {            while ($product = $result->fetch_assoc()) {                $tr .= '                <tr>                    <th scope="row">' . $product['id'].'</th>                    <td>' . $product['product_name'].'</td>                    <td>' . $product['unit_price'].'</td>                    <td>' . $product['current_stack'].'</td>                    <td>' . $product['item_color'].'</td>                    <td>' . $product['branch'].'</td>                    <td>                        <button value="'.$product['id'] . '" id="btn_update" type="button" class="btn  btn-primary">                            Update                        </button>                        <button value="' . $product['id'] . '" id="btn_archive" class="btn btn-danger">                            Archive                        </button>                    </td>                </tr>            ';            }        }        echo $tr;    }    // method for updating the products    public function UpdateProducts($id)    {        try {            $query = "select * from product where id = ?";            $stmt = $this->Connect()->prepare($query);            $stmt->bind_param('i',$id);            $stmt->execute();// wag kalimutan            $result = $stmt->get_result();            return $result->fetch_assoc();        }catch (Exception $e){            error_log('Error'.$e->getMessage());            return [];        }    }    public function SaveUpdatedProduct($productName,$unitPrice,$itemColor,$currentStack,$Branch,$id)    {        try {            $query =  "update product set product_name = ? ,unit_price = ? ,item_color = ? , current_stack = ? ,branch = ? where id = ?";            $stmt = $this->Connect()->prepare($query);            $stmt->bind_param('sdsisi',$productName,$unitPrice,$itemColor,$currentStack,$Branch,$id);            if ($stmt->execute()){                echo json_encode(['success' => true, 'message' => 'product is successfully updated']);                //---------------------------Logs-------------------------------------                $log = new logs();                session_start();                if (isset($_SESSION['admin'])){                    $username = $_SESSION['admin'];                    $log->makeLogs($username, 'Update', "Product  $productName was updated.");                } else {                    echo json_encode(['success' => false, 'message' => 'Product name not found']);                }                //---------------------------Logs-------------------------------------            }else{                echo json_encode(['success' => false, 'message' => 'Failed to Update']);            }        }catch (Exception $e){            error_log('Error'.$e->getMessage());        }    }    // to archive the product     public function ArchiveProduct($id)     {         try {             $query = "update product set status = 'is_deleted' where id = ?";             $stmt = $this->Connect()->prepare($query);             $stmt->bind_param('i',$id);             if ($stmt->execute()){                 echo json_encode(['success' => true, 'message' => 'product is successfully deleted']);                 //---------------------------Logs-------------------------------------                 $log = new logs();                 session_start();                 if (isset($_SESSION['admin'])){                     $username = $_SESSION['admin'];                     $log->makeLogs($username, 'Archive', "Product with ID '$id' was archived.");                 } else {                     echo json_encode(['success' => false, 'message' => 'product id not found']);                 }                 //---------------------------Logs-------------------------------------             }else{                 echo json_encode(['success' => false, 'message' => 'failed to delete product']);             }         }catch (Exception $e){             error_log('Error'.$e->getMessage());         }     }     // add Product    public  function AddProduct($unitPrice,$currentStack,$Branch,$productName,$itemColor,$Status)    {        try {            $query = "insert into product(unit_price, current_stack, branch, product_name, item_color, status)values (?,?,?,?,?,?)";            $stmt = $this->Connect()->prepare($query);            $stmt->bind_param('dissss',$unitPrice,$currentStack,$Branch,$productName,$itemColor,$Status);            if ($stmt->execute()){                echo json_encode(['success' => true, 'message' => 'New Product is Successfully Added']);            }else{                echo json_encode(['success' => false, 'message' => 'Failed to add Product' , 'error' => $stmt->error]);            }        }catch (Exception $e){            error_log('Errors'.$e->getMessage());        }    }    public function DisplaySum()    {        $result = $this->Connect()->query("SELECT COUNT(*) AS TotalProduct From product");        $con = '';        while ($Product = $result->fetch_assoc()){          $con .= '            <h3 class="fw-bold" "  style="color:#ffffff;">'.number_format($Product['TotalProduct']).'</h3>          ';        }        echo $con;    }    // display the stack alert    public function DisplayLowStack()    {        $result = $this->Connect()->query("SELECT COUNT(*) AS lowStack From product where current_stack <= 5");        while ($lowStack = $result->fetch_assoc()){            ?>            <h3 class="fw-bold" style="color:#ffffff;"><?= number_format($lowStack['lowStack']) ?></h3>            <?php        }    }    // display the branches    public function DisplayBranch()    {       $result = $this->Connect()->query("select * from brance where status = 'Active'");       return $result->fetch_all();    }    public function showProductName()    {        $query = "SELECT product_name,id from product where status = ?";        $stmt = $this->Connect()->prepare($query);        $stmt->bind_param('s',$this->productStatus);        $stmt->execute();        $result = $stmt->get_result();        if ($result->num_rows > 0){            $dataRow = [];            while ($row = $result->fetch_assoc()){                $dataRow[] = $row;            }            return $dataRow;        }        return  null;    }}